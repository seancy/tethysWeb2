<template>
    <div id="header">
      <div class="topbar">
          <div class="topleft">
              <span class="icon_clock"></span>
              <span>07 September. 23:45 <small>美东时间</small></span>
          </div>
          <div class="topright">
              <span class="tel"><span class="icon_sprite icon_tel"></span>+63 945-456-456</span>
              <a class="signup" href="sign-up.html"><span class="icon_sprite icon_account"></span>免费开户</a>
              <a class="help" href="help.html"><span class="icon_sprite icon_info"></span>新手指南</a>
              <span class="info">
                  <a class="link blue-green" href="javascript:;">糖果派对1-2</a>
                  <a class="link blue" href="javascript:;">MG老虎机</a>
                  <a class="link green" href="javascript:;">PT角子机</a>
                  <a class="link yellow-green" href="javascript:;">MW千炮捕鱼</a>
                  <a class="link yellow" href="javascript:;">时时彩</a>
                  <a class="link red" href="javascript:;">连环夺宝</a>
                  <span>BC彩票天天返水1.2%</span>
                  <span>MG返水1.2%</span>
              </span>
          </div>
      </div>
      <div class="nav">
          <div class="logo"><h1><img src="static/images/logo.png" alt="金沙赌场"></h1></div>
          <div class="menu">
              <ul class="mainmenu">
                  <li class="active">
                      <a href="/"><h2>首页</h2><small>HOME</small></a>
                  </li>
                  <li class="hot">
                      <a href="/live"><h2>真人视讯</h2><small>LIVE</small></a>
                      <ul class="submenu">
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/mg.png)"></span>
                                      <span style="background-image: url(../static/images/brand/mg.png)"></span>
                                  </div>
                                  <h3>MG视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/bbin.png)"></span>
                                      <span style="background-image: url(../static/images/brand/bbin.png)"></span>
                                  </div>
                                  <h3>BB视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/ag.png)"></span>
                                      <span style="background-image: url(../static/images/brand/ag.png)"></span>
                                  </div>
                                  <h3>AG视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/pt.png)"></span>
                                      <span style="background-image: url(../static/images/brand/pt.png)"></span>
                                  </div>
                                  <h3>PT视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/dg.png)"></span>
                                      <span style="background-image: url(../static/images/brand/dg.png)"></span>
                                  </div>
                                  <h3>DG视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/lebo.png)"></span>
                                      <span style="background-image: url(../static/images/brand/lebo.png)"></span>
                                  </div>
                                  <h3>LEBO视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/sb.png)"></span>
                                      <span style="background-image: url(../static/images/brand/sb.png)"></span>
                                  </div>
                                  <h3>SB视讯</h3>
                              </a>
                          </li>
                          <li>
                              <a href="live.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/gd.png)"></span>
                                      <span style="background-image: url(../static/images/brand/gd.png)"></span>
                                  </div>
                                  <h3>GD视讯</h3>
                              </a>
                          </li>
                      </ul>
                  </li>
                  <li>
                      <a href="/casino"><h2>电子游艺</h2><small>CASINO</small></a>
                      <ul class="submenu">
                          <li>
                              <a href="casino.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/mg.png)"></span>
                                      <span style="background-image: url(../static/images/brand/mg.png)"></span>
                                  </div>
                                  <h3>MG电子</h3>
                              </a>
                          </li>
                          <li>
                              <a href="casino.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/bbin.png)"></span>
                                      <span style="background-image: url(../static/images/brand/bbin.png)"></span>
                                  </div>
                                  <h3>BB电子</h3>
                              </a>
                          </li>
                          <li>
                              <a href="casino.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/ag.png)"></span>
                                      <span style="background-image: url(../static/images/brand/ag.png)"></span>
                                  </div>
                                  <h3>AG电子</h3>
                              </a>
                          </li>
                          <li>
                              <a href="casino.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/pt.png)"></span>
                                      <span style="background-image: url(../static/images/brand/pt.png)"></span>
                                  </div>
                                  <h3>PT电子</h3>
                              </a>
                          </li>
                          <li>
                              <a href="casino.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/mgw.png)"></span>
                                      <span style="background-image: url(../static/images/brand/mgw.png)"></span>
                                  </div>
                                  <h3>MGW电子</h3>
                              </a>
                          </li>
                      </ul>
                  </li>
                  <li>
                      <a href="/sports"><h2>体育竞技</h2><small>SPORTS</small></a>
                      <ul class="submenu">
                          <li>
                              <a href="sports.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/mg.png)"></span>
                                      <span style="background-image: url(../static/images/brand/mg.png)"></span>
                                  </div>
                                  <h3>BB体育</h3>
                              </a>
                          </li>
                          <li>
                              <a href="sports.html">
                                  <div class="img">
                                      <span style="background-image: url(../static/images/brand/ug.png)"></span>
                                      <span style="background-image: url(../static/images/brand/ug.png)"></span>
                                  </div>
                                  <h3>UG体育</h3>
                              </a>
                          </li>
                      </ul>
                  </li>
                  <li>
                      <a href="/lottery"><h2>彩票游戏</h2><small>LOTTERY</small></a>
                  </li>
                  <li>
                      <a href="/promo"><h2>优惠活动</h2><small>PROMO</small></a>
                  </li>
                  <li>
                      <a href="javascript:;"><h2>在线客服</h2><small>SERVICE</small></a>
                  </li>
              </ul>
          </div>
      </div>
      <!--登录后资讯（登录后显示）-->
      <div class="account_bar login" v-if="hasLogin===true">
          <span class="account">
              <span>{{userName}}</span>
              <a href="personal-msg.html" class="icon_sprite icon_mail"><small>4</small></a>
          </span>
          <span>¥ {{memberInfo.balance | balanceNo}}<a href="javascript:;" class="icon_sprite icon_refresh" @click="getAccountInfo()"></a></span>
          <span><a href="/personalInfo">个人中心</a></span>
          <span><a href="javascript:;" v-on:click.prevent="deposit_judge()" click="de">存款</a></span>
          <span><a href="javascript:;" v-on:click.prevent="draw_judge()">取款</a></span>
          <span><a href="/personalBettin">投注纪录</a></span>
          <span><a href="/personalFunds">资金纪录</a></span>
          <span><a href="javascript:;" class="logout" @click.prevent="common.logOut">【退出】</a></span>
      </div><!--end 登录后资讯（登录后显示）-->

      <!--登录列-->
      <div class="account_bar" v-if="hasLogin===false">
          <span class="account">
              <input placeholder="请输入会员账号" type="text" v-model="loginParam.username" @keyup.enter="logIn()">
          </span>
          <span class="password">
              <input placeholder="请输入密码" type="password" v-model="loginParam.password" @keyup.enter="logIn()">
          </span>
          <span class="code">
              <input placeholder="请输入验证码" type="text" v-model="loginParam.code">
              <img src="static/images/verification-code.jpg" alt=""><a class="icon_refresh" href="javascript:;"></a>
              <a href="javascript:;" class="icon_sprite icon_refresh"></a>
          </span>
          <span class="btn">
              <a class="btn_login" href="javascript:;" @click="logIn" :class="'btn-login '+(isLoging?'link_disable':'')">会员登录</a>
              <a class="btn_reg" href="javascript:;">注册会员</a>
          </span>
      </div><!--end 登录列-->



  </div>
</template>

<script>
var md5 = require('md5');
export default {
  name: 'topHeader',
  data: function () {
    return {
      common:common,
      pagename: '',
      urlPath: '',
      userName: '',
      siteName: '',
      hasLogin: false,
      footer: [],
      navBar: [],
      customtemplate:[],
      memberInfo: {},
      times: '',
      photo_url: '',
      leftURL: [],
      rightURL: [],
      newBalance: '',
      leftLink:'',
      rightLink:'',
      userId:'',
      loginParam: {
        username: 'vct033',
        password: '123456',
        code: '1'
      },
      verImgCode:'',
      isLoging: false
      // msg: 'Welcome to Your Vue.js App'
    }
  },
  created:function() {
    var _this = this;
    _this.urlPath = _this.$route.path.replace('/', '');
    _this.userName = common.Cookie.get('userName') || '';
    _this.hasLogin = common.ifLanded();
    _this.pagename = _this.$route.name || '';
    _this.photo_url = common.photo_url;
    // 先取cookie里的值初始化页面，防止空白
    _this.siteName = common.Cookie.get('siteName') || [];
    _this.navBar = common.Cookie.get('navBar') && JSON.parse(common.Cookie.get('navBar')) || [];
    _this.footer = common.Cookie.get('footer') && JSON.parse(common.Cookie.get('footer')) || [];

    var that = this;
    if (this.hasLogin === true) {
        this.memberInfo = common.Cookie.get('memberInfo') && JSON.parse(common.Cookie.get('memberInfo')) || {};
        //如下ajax请求是在任何链接跳转时更新余额
        common.ajax('member/balance/get', {}, function(data) {
            that.memberInfo.balance = data && data.result && data.result.balance.toString().replace(/(\d{1,2})(?=(\d{3})+\.)/g, '$1,');
            common.Cookie.set('memberInfo', JSON.stringify(that.memberInfo));
            $("#mynew_balance").html(data && data.result && data.result.balance.toString().replace(/(\d{1,2})(?=(\d{3})+\.)/g, '$1,'));
            $(".account-num").html(data && data.result && data.result.balance.toString().replace(/(\d{1,2})(?=(\d{3})+\.)/g, '$1,'));
            $(".wallet_balance").html(data && data.result && data.result.balance.toString().replace(/(\d{1,2})(?=(\d{3})+\.)/g, '$1,'));
        });
        this.userId = "";
        this.getUserInfo();
    }
    else {
   /*     $(document).on("keydown",function(e){
            if(e.keyCode==13) {
                that.logIn();
            }
        });*/
        that.getCode();
    }
  },
  filters: {
      balanceNo: function(value) {
          return common.FormatNumber.get(value);
      },
      number_message: function(vaule) {
          return (vaule) ? vaule : 0;
      }
  },
  methods: {
    logIn: function () {
      var _self = this
      var username = _self.loginParam.username
      var password = _self.loginParam.password
      var enterCode = _self.loginParam.code
      if (!common.positiveEngNum(username) || username.length<4 || username.length>15) {
        common.toast({content: "账号应在4-15个字符之间！"});
        return;
      }
      if (!common.positiveEngNum(password) || password.length<6 || password.length>20) {
        common.toast({content: "密码应在6-20个字符之间！"});
        return;
      }
      $(".btn-login").attr("disabled","true");
      setTimeout("$('.btn-login').removeAttr('disabled')",2000);
      _self.isLoging = true;
      common.ajax('member/login', {
        username: username,
        password: md5(password),
        code: enterCode
      }, (data) => {
        // _self.isLoging = false;
        common.Cookie.set('userName', data.result && data.result.username || '');
        common.Cookie.set('token', data.result && data.result.token || '');
        common.Cookie.set('memberInfo', JSON.stringify(data.result));
        common.toast({title: '提示信息', content: '登录成功！', time: 2});
        $("#free_open_account").hide();
        setTimeout(function () {
          window.location.reload();
        }, 2000);
      }, 'post', function () {
        setTimeout(function () {
          _self.isLoging = false;
        }, 800);
        _self.getCode();
      }, function () {
        setTimeout(function () {
          _self.isLoging = false;
        }, 800);
        _self.getCode();
      });
    }, 
    getCode: function () {
        var _self = this;
        common.ajax('member/code/get', {
            width: 112,
            height: 37
        }, function (data) {
            common.Cookie.set('clientId', data.result && data.result.clientId || '');
            _self.verImgCode = data.result && 'data:image/png;base64,' + data.result.code || '';
        });
        _self.$nextTick(function () {
            $('.icon-refresh')
            .removeAttr("style");

            setTimeout(function () {
                $('.icon-refresh').css({
                    cursor: 'pointer',
                    transition: 'all 3s',
                    transform: 'rotate(720deg)'
                });
            }, 300);
        });
    },
    deposit_judge:function(){
      common.ajax('tethys-user/user/menu/level/auth', {}, function(data) {
          if (data && data.apistatus == 1) {
              if (data && data.result == 0) { // 1锁定 0 非锁定
                  location.href = "deposit";
              } else {
                  common.toast({
                      content: '当前无法操作，请联系客服',
                      time: 3
                  });
              }
          }
      }, 'get', function(data){
          if(data.apistatus == '0' && data.errorCode == '1000020'){

              common.toast({content: '会员未登录！', time: 1});

              setTimeout( 'common.logOut()',1000);
          }
          if(data.errorCode == '1000003'){
              common.toast({content: '该会员已被停用！', time: 1});
              setTimeout( 'common.logOut()',1000);
          }
      });
    },
    draw_judge: function() { //取款
      common.ajax('tethys-user/user/menu/level/auth', {}, function(data) {
          if (data && data.apistatus == 1) {
              if (data && data.result == 0) { // 1锁定 0 非锁定
                  location.href = "callin";
              } else {
                  common.toast({
                      content: '当前无法操作，请联系客服',
                      time: 3
                  });
              }
          }
      }, 'get', function(data){
          if(data.apistatus == '0' && data.errorCode == '1000020'){

              common.toast({content: '会员未登录！', time: 1});

              setTimeout( 'common.logOut()',1000);
          }
          if(data.errorCode == '1000003'){
              common.toast({content: '该会员已被停用！', time: 1});
              setTimeout( 'common.logOut()',1000);
          }
      });
    },
    getAccountInfo: function() {
        var _self = this;
        $(".lone").click();
        $(".sone").removeClass("icon-refreshhover");
        $(".sone").addClass("icon-refreshmyword");
        common.ajax('member/refresh', {}, function(data) {
            setTimeout(function() {
                $(".sone").removeClass("icon-refreshmyword");
            }, 600);
            _self.memberInfo = $.extend({}, data && data.result || {});
            _self.memberInfo.balance = data && data.result.balance.toString().replace(/(\d{1,2})(?=(\d{3})+\.)/g, '$1,');
            $("#mynew_balance").html(_self.memberInfo.balance);
            $(".account-num").html(_self.memberInfo.balance);
            $(".wallet_balance").html(_self.memberInfo.balance);
            common.Cookie.set('memberInfo', JSON.stringify(_self.memberInfo));
        });
    },
    getUserInfo: function () {
        var _self = this;
        common.ajax('tethys-user/user/menu/userInfo',{}, function (data) {
            _self.userId = data.result || '';
        },'get', function(data){
            if(data.apistatus == '0' && data.errorCode == '1000020'){

                common.toast({content: '会员未登录！', time: 1});

                setTimeout( 'common.logOut()',1000);
            }
            if(data.errorCode == '1000003'){
                common.toast({content: '该会员已被停用！', time: 1});
                setTimeout( 'common.logOut()',1000);
            }
        });
    },
  }
  
}
</script>